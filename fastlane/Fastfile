default_platform(:android)

platform :android do

  desc "Analiza el código con SonarQube"
  lane :scan_code do
    if ENV['SONAR_TOKEN'].to_s.empty?
      UI.user_error!("❌ ERROR CRÍTICO: La variable SONAR_TOKEN está vacía. Revisa tus GitHub Secrets.")
    else
      UI.success("✅ SONAR_TOKEN detectado (Longitud: #{ENV['SONAR_TOKEN'].length} caracteres)")
    end
    gradle(task: "clean assembleDebug")

    gradle(
      task: "sonar",
      flags: "--info --stacktrace " +
             "--init-script /workspace/sonar-injection.gradle.kts " +
             "-Dsonar.host.url=#{ENV['SONAR_HOST_URL']} " +
             "-Dsonar.token=#{ENV['SONAR_TOKEN']} " +
             "-Dsonar.projectKey=#{ENV['SONAR_PROJECT_KEY']}"
    )
  end

  desc "Publica el artefacto en Nexus"
  lane :publish_nexus do

    gradle(task: "publishReleasePublicationToNexusOnPremiseRepository")
  end

end